<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />

    <title>Change Passowrd</title>
    <link rel="icon" type="image/png" href="/assets/img/logo.gif" />
    <style>
      .mainDiv {
        display: flex;
        min-height: 100%;
        align-items: center;
        justify-content: center;

        font-family: "Open Sans", sans-serif;
      }
      #pwd {
        background-color: #f9f9f9;
      }
      .cardStyle {
        width: 500px;
        border-color: white;
        background: #fff;
        padding: 36px 0;
        border-radius: 4px;
        margin: 30px 0;
        box-shadow: 0px 0 2px 0 rgba(0, 0, 0, 0.25);
      }
      #signupLogo {
        max-height: 100px;
        margin: auto;
        display: flex;
        flex-direction: column;
      }
      .formTitle {
        font-weight: 600;
        margin-top: 20px;
        color: #2f2d3b;
        text-align: center;
      }
      .inputLabel {
        font-size: 12px;
        color: #555;
        margin-bottom: 6px;
        margin-top: 24px;
      }
      .inputDiv {
        width: 70%;
        display: flex;
        flex-direction: column;
        margin: auto;
      }
      input {
        height: 40px;
        font-size: 16px;
        border-radius: 4px;
        border: none;
        border: solid 1px #ccc;
        padding: 0 11px;
      }
      input:disabled {
        cursor: not-allowed;
        border: solid 1px #eee;
      }
      .buttonWrapper {
        margin-top: 40px;
      }
      .submitButton {
        width: 70%;
        height: 40px;
        margin: auto;
        display: block;
        color: #fff;
        background-color: #065492;
        border-color: #065492;
        text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.12);
        box-shadow: 0 2px 0 rgba(0, 0, 0, 0.035);
        border-radius: 4px;
        font-size: 14px;
        cursor: pointer;
      }
      .submitButton:disabled,
      button[disabled] {
        border: 1px solid #cccccc;
        background-color: #cccccc;
        color: #666666;
      }
      /* 
#loader {
  position: absolute;
  z-index: 1;
  margin: -2px 0 0 10px;
  border: 4px solid #f3f3f3;
  border-radius: 50%;
  border-top: 4px solid #666666;
  width: 14px;
  height: 14px;
  -webkit-animation: spin 2s linear infinite;
  animation: spin 2s linear infinite;
} */

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <section id="pwd">
      <div class="mainDiv pt-5">
        <div class="container d-flex justify-content-center">
          <div class="card col-md-6 pb-5">
            <form
              action="/changepswd"
              method="post"
              name="signupForm"
              id="signupForm"
            >
              <!-- <img src="" id="signupLogo"/> -->
              <input
                type="text"
                id="user_details"
                name="user_details"
                value="<%=user%>"
                hidden
              />
              <img
                src="https://tvmcreport.org/img/logo3.gif"
                id="signupLogo"
                class="img-fluid img-circle elevation-2 mt-3"
                alt="Logo"
              />
              <h2 class="formTitle">Change Password</h2>
              <div class="inputDiv">
                <% if (message.length > 0) { %>
                <div class="alert alert-info col-sm-12"><%= message %></div>
                <% } %>
                <label class="inputLabel" for="password">Old Password</label>
                <input
                  type="password"
                  id="passwor"
                  name="old_password"
                  required
                />
              </div>
              <div class="inputDiv">
                <label class="inputLabel" for="password">New Password</label>
                <input
                  type="password"
                  id="password"
                  name="new_password"
                  required
                />
              </div>

              <div class="inputDiv">
                <label class="inputLabel" for="confirmPassword"
                  >Confirm Password</label
                >
                <input
                  type="password"
                  id="confirmPassword"
                  name="confirmPassword"
                />
              </div>

              <div class="buttonWrapper">
                <button
                  type="submit"
                  id="submitButton"
                  onclick="validateSignupForm()"
                  class="submitButton pure-button pure-button-primary"
                >
                  <span>submit</span>
                  <span id="loader"></span>
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script>
      // function cpwd() {
      //   var user_details = document.getElementById('user_details').value;
      //   var old = document.getElementById('passwor').value;
      //   var newpwd = document.getElementById('confirmPassword').value;
      //   var
      //   var xhr;
      //   if (window.XMLHttpRequest) {
      //     xhr = new XMLHttpRequest();
      //   } else {
      //     xhr = new ActiveXObject("Microsoft.XMLHTTP");
      //   }
      //   xhr.open("POST", "/changepswd", true);
      //   xhr.setRequestHeader(
      //     "Content-type",
      //     "application/x-www-form-urlencoded"
      //   );

      //   // xhr.timeout
      //   xhr.onreadystatechange = function () {
      //     if (xhr.readyState == 4 && xhr.status == 200) {
      //       // document.getElementById("response").innerHTML =
      //       //   xhr.responseText;

      //       const data = JSON.parse(this.responseText);
      //     }
      //   };
      //   data={
      //     user_details:user_details,
      //     old:old,
      //     newpwd:newpwd
      //   }
      //   xhr.send('data='+JSON.stringify(data));
      // }
    </script>
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <script>
      var password = document.getElementById("password"),
        confirm_password = document.getElementById("confirmPassword");

      // document.getElementById('signupLogo').src = "https://s3-us-west-2.amazonaws.com/shipsy-public-assets/shipsy/SHIPSY_LOGO_BIRD_BLUE.png";
      // enableSubmitButton();

      function validatePassword() {
        if (password.value != confirm_password.value) {
          confirm_password.setCustomValidity("Passwords Don't Match");
          return false;
        } else {
          confirm_password.setCustomValidity("");
          return true;
        }
      }

      password.onchange = validatePassword;
      confirm_password.onkeyup = validatePassword;

      function enableSubmitButton() {
        document.getElementById("submitButton").disabled = false;
        document.getElementById("loader").style.display = "none";
      }

      function disableSubmitButton() {
        document.getElementById("submitButton").disabled = true;
        document.getElementById("loader").style.display = "unset";
      }

      function validateSignupForm() {
        var form = document.getElementById("signupForm");

        for (var i = 0; i < form.elements.length; i++) {
          if (
            form.elements[i].value === "" &&
            form.elements[i].hasAttribute("required")
          ) {
            console.log("There are some required fields!");
            return false;
          }
        }

        if (!validatePassword()) {
          return false;
        }

        onSignup();
      }

      function onSignup() {
        // var xhttp = new XMLHttpRequest();
        // xhttp.onreadystatechange = function () {
        //   disableSubmitButton();
        //   if (this.readyState == 4 && this.status == 200) {
        //     enableSubmitButton();
        //   } else {
        //     console.log("AJAX call failed!");
        //     setTimeout(function () {
        //       enableSubmitButton();
        //     }, 1000);
        //   }
        // };
        // xhttp.open("GET", "ajax_info.txt", true);
        // xhttp.send();
      }
    </script>
  </body>
</html>
